<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team.mapper.ProjectMapper">
	
	<resultMap type="project" id="projectMap">
		<id column="project_no" property="projectNo" />
		<result column="workspace_no" property="workspaceNo" />
		<result column="project_name" property="projectName" />
		<result column="startdate" property="startdate" />
		<result column="content" property="content" />
		<result column="manager_email" property="managerEmail" />
		<result column="deleted" property="deleted" />
		<result column="pro_public" property="proPublic" />
		<result column="template_no" property="templateNo" />
		<result column="pro_no" property="proNo" />
	</resultMap>
	
	<insert id="insertProject">
		INSERT INTO project ( project_name, content, manager_email, pro_public, template_no, workspace_no)
		VALUES ( #{projectName}, #{content}, "1@1", #{proPublic}, #{templateNo}, "6" )
	</insert>
	
	<select id="selectProject" resultMap="projectMap">
		<![CDATA[ SELECT * FROM project WHERE deleted = 0 ORDER BY project_no DESC ]]>
	</select>
	
	<select id="selectProject2" resultMap="projectMap">
		<![CDATA[ SELECT * FROM project WHERE deleted = 0 ORDER BY project_no DESC LIMIT 4 ]]>
	</select>
	
	<select id="selectProjectByWorkspaceNo" parameterType="int" resultMap="projectMap">
		SELECT * FROM project
		WHERE workspace_no = #{ workspaceNo } 
	</select>
	
	<update id="updateProjectNo" parameterType="hashmap">
		UPDATE project SET pro_no=#{ proNo } 
		WHERE project_no = #{ projectNo }
	</update>
	

	<sql id="searchCondition">
		<trim suffix="AND">
	    	<choose>
	    		<when test="searchType == 'T'.toString()">
	    			project_name LIKE '%'||#{searchKey}||'%'
	    		</when>
	    		<when test="searchType == 'C'.toString()">
	    			content LIKE '%'||#{searchKey}||'%'
	    		</when>
	    		<when test="searchType == 'TC'.toString()">
	    			( project_name LIKE '%'||#{searchKey}||'%' OR content LIKE '%'||#{searchKey}||'%' )
	    		</when>
	    		<when test="searchType == 'P'.toString()">
	    			pro_public LIKE '%'||#{searchKey}||'%'
	    		</when>
	    	</choose>
		</trim>
	</sql>
	
	<select id="selectPageing" parameterType="hashmap" resultMap="projectMap">
<!-- 		SELECT *
		FROM (
			  SELECT row_number() over(order by project_no) rnum,project_no,project_name, manager_email, startdate, pro_public, template_no, pro_no
		      FROM project
		      WHERE <include refid="searchCondition" /> deleted = '0'
		      AND <![CDATA[ project_no < #{ end } ]]>
		      ORDER BY project_no desc
		     ) project
		WHERE <![CDATA[ project_no >=  #{ beginningPageNo } ]]> -->
		
		<!-- SELECT *
		FROM (
				SELECT <![CDATA[ @rownum:=@rownum+1 rnum, A.* ]]>
				FROM project A,
					  <![CDATA[ (SELECT @rownum := 0 ) R ]]>
				WHERE 1=1 AND <include refid="searchCondition" /> deleted = '0'
				ORDER BY project_no DESC
				) list
		WHERE <![CDATA[ rnum >= #{ beginningPageNo } AND rnum <= #{ end } ]]> -->
	</select>
	<select id="selectProjectListCount" parameterType="hashmap" resultType="int" >
		SELECT COUNT(*) FROM project WHERE <include refid="searchCondition" /> deleted = '0' ORDER BY project_no DESC
	</select>


<!-- 	<resultMap type="project" id="projectMap">
		<id column="project_no" property="projectNo" />
		<result column="workspace_no" property="workspaceNo" />
		<result column="project_name" property="projectName" />
		<result column="regdate" property="regdate" />
		<result column="content" property="content" />
		<result column="manager_email" property="managerEmail" />
		<result column="deleted" property="deleted" />
		<result column="public" property="isPublic" />
		<result column="template_no" property="templateNo" />
	</resultMap> 
	-->
	<!-- 
  SELECT ~~, ( @rownum:=@rownum+1 ) AS rownum FROM ( SELECT ~~ FROM TABLE ) AS a, ( SELECT @rownum:=0 ) AS b;
		
		
초기화 후
SET @rownum:=0; 
 
조회 
SELECT
@rownum:=@rownum+1, b.*
FROM project b

SELECT
@rownum:=@rownum+1, b.*
FROM project b, (SELECT @rownum:=0) TMP;

select @rownum:=0 ;

    
SELECT *
  FROM (
        	 SELECT @rownum:=@rownum+1 as num,project_no,project_name, manager_email, startdate, deleted
      	 FROM project
          WHERE deleted = '0'
          AND project_no < 10
          ORDER BY project_no desc
        ) project
 WHERE project_no BETWEEN project_no AND  5;
 
SELECT *
FROM (
		SELECT @rownum:=@rownum+1 rnum, A.*
		FROM project A,
			  (SELECT @rownum := 0 ) R
		WHERE 1=1 AND deleted = '0'
		ORDER BY project_no DESC
		) list
WHERE rnum >= 1 AND rnum <= 29;
 
SELECT *
FROM (
		  SELECT @rownum:=@rownum+1  rnum,  A.* 
		  FROM project A, 
		      (SELECT @ROWNUM := 0) R
		  WHERE 1=1
		) list
WHERE rnum >= 1 AND rnum <=10 ; -->
</mapper>





